import{j as e,m as B,r as N,y as K,R as ae,z as U,aD as ne,aE as re,aF as ie,d as le,aG as oe,B as S}from"./index-DVmOQZrp.js";import{a as ce,u as de,t as ue}from"./zod-CVPUgilw.js";import{z as n}from"./index-DXqQCM1T.js";import{a as me,b as Q,s as ge}from"./Samples-DUG5vYRn.js";n.string().regex(/^[0-9a-fA-F]{24}$/);const E=n.object({section:n.enum(["reading","listening","speaking","writing","general","grammar","vocabulary","general"]),questionText:n.string().max(1e3).min(10),instruction:n.string().min(10).max(500),isPublic:n.boolean().default(!0),difficulty:n.number().int().min(1).max(5)}),pe=E.extend({type:n.literal("multiple_choice"),answers:n.array(n.string()).min(2).max(6),correctAnswers:n.array(n.boolean())}),he=E.extend({type:n.literal("single_choice"),answers:n.array(n.string()).min(2).max(6),correctAnswer:n.string()}),xe=E.extend({type:n.literal("fill_in_the_blank"),text:n.string().max(1e3),blanks:n.array(n.object({index:n.number().int().nonnegative(),correctAnswer:n.string(),options:n.array(n.string().min(1,"Option cannot be empty")).max(6,"Maximum 6 options allowed").optional().default([])})).min(1,"At least one blank is required")}),be=E.extend({type:n.literal("matching"),leftColumn:n.array(n.object({id:n.number().int().positive(),text:n.string()})),rightColumn:n.array(n.object({id:n.string(),text:n.string()})),correctPairs:n.array(n.object({left:n.number().int().positive(),right:n.string()}))}),fe=E.extend({type:n.literal("true_false"),statement:n.string().min(10).max(500),correctAnswer:n.boolean()}),ye=E.extend({type:n.literal("open_ended"),prompt:n.string().max(1e3)}),je=E.extend({type:n.literal("essay"),minWords:n.number().int().positive(),maxWords:n.number().int().positive(),rubric:n.string().max(2e3)}),ke=E.extend({type:n.literal("ordering"),items:n.array(n.object({id:n.string(),text:n.string()})),correctOrder:n.array(n.string())}),X=n.discriminatedUnion("type",[pe,he,xe,be,fe,ye,je,ke]).superRefine((t,s)=>{switch(t.type){case"multiple_choice":t.correctAnswers.filter(Boolean).length<2&&s.addIssue({code:n.ZodIssueCode.custom,message:"At least two correct answers must be selected.",path:["correctAnswers"]});break;case"fill_in_the_blank":const r=(t.text.match(/_____/g)||[]).length;r===0&&s.addIssue({code:n.ZodIssueCode.custom,message:"Text must contain at least one blank marked with '_____'",path:["text"]}),r!==t.blanks.length&&t.text.includes("_____")&&t.text!==""&&s.addIssue({code:n.ZodIssueCode.custom,message:"Number of blanks must match the number of blanks provided.",path:["blanks"]}),t.blanks.forEach((a,i)=>{a.options.length>0&&!a.options.includes(a.correctAnswer)&&s.addIssue({code:n.ZodIssueCode.custom,message:`The correct answer must be in the options at index ${i+1}`,path:["blanks",i,"options"]}),a.options.length>6&&s.addIssue({code:n.ZodIssueCode.custom,message:`At most 6 options are allowed per blank at index ${i+1}`,path:["blanks",i,"options"]}),a.correctAnswer===""&&s.addIssue({code:n.ZodIssueCode.custom,message:`The correct answer cannot be empty at index ${i+1}`,path:["blanks",i,"correctAnswer"]})});break;case"single_choice":t.answers=t.answers.filter(a=>a!==""),t.answers.includes(t.correctAnswer)||s.addIssue({code:n.ZodIssueCode.custom,message:"The correct answer must be one of the answer options.",path:["correctAnswer"]}),t.answers.length<4&&s.addIssue({code:n.ZodIssueCode.custom,message:"At least 4 answer options must be provided.",path:["answers"]});break;case"essay":t.maxWords<=t.minWords&&s.addIssue({code:n.ZodIssueCode.custom,message:"Maximum word count must be greater than minimum word count.",path:["maxWords"]});break;case"matching":t.leftColumn.length<2&&s.addIssue({code:n.ZodIssueCode.custom,message:"At least 2 items must be provided in the left column.",path:["leftColumn"]}),t.rightColumn.length!==t.leftColumn.length&&s.addIssue({code:n.ZodIssueCode.custom,message:"Right column must have the same number of items as left column.",path:["rightColumn"]}),t.correctPairs.every(a=>t.leftColumn.some(i=>i.id===a.left))||s.addIssue({code:n.ZodIssueCode.custom,message:"All items in the correct order must exist in the items list.",path:["correctPairs"]}),t.correctPairs.every(a=>t.rightColumn.some(i=>i.id===a.right))||s.addIssue({code:n.ZodIssueCode.custom,message:"All items in the correct order must exist in the items list.",path:["correctPairs"]});break;case"ordering":t.correctOrder.every(a=>t.items.some(i=>i.id===a))||s.addIssue({code:n.ZodIssueCode.custom,message:"All items in the correct order must exist in the items list.",path:["correctOrder"]}),(t.items.length<3||t.items.length>8)&&s.addIssue({code:n.ZodIssueCode.custom,message:"At least 3 items must be provided and at most 8 items.",path:["items"]}),t.correctOrder.length!==t.items.length&&s.addIssue({code:n.ZodIssueCode.custom,message:"The correct order must have the same length as the items list.",path:["correctOrder"]}),new Set(t.correctOrder).size!==t.correctOrder.length&&s.addIssue({code:n.ZodIssueCode.custom,message:"The correct order must not have duplicates.",path:["correctOrder"]});break;case"true_false":t.correctAnswer!==!0&&t.correctAnswer!==!1&&s.addIssue({code:n.ZodIssueCode.custom,message:"The correct answer must be either true or false.",path:["correctAnswer"]});break}}),Y=n.object({title:n.string().min(10).max(200),text:n.string().min(10).max(5e3),url:n.string().url().optional().or(n.literal(""))}),we=Y.extend({passageType:n.literal("reading")}),ve=Y.extend({passageType:n.literal("listening"),soundFile:n.instanceof(File).refine(t=>t.size<=1e9,{message:"The sound file must be less than 10MB"}).refine(t=>["audio/mpeg","audio/ogg","audio/wav"].includes(t.type),{message:"The sound file must be an MP3, WAV, or OGG audio file"})}),Ne=n.discriminatedUnion("passageType",[we,ve]),$e=n.object({passage:Ne,questions:n.array(X).min(1)}),Ce=n.object({question:X}),_e=n.discriminatedUnion("section",[n.object({section:n.enum(["reading","listening"]),data:$e}),n.object({section:n.enum(["speaking","writing","general","vocabulary","grammar"]),data:Ce})]);function Fe({id:t,type:s,registerOptions:r,className:a,placeholder:i,required:m,disabled:x=!1}){return e.jsx("input",{id:t,type:s,...r,className:a,placeholder:i,required:m,disabled:x})}function Ae({id:t,registerOptions:s,className:r,placeholder:a,required:i,defaultValue:m}){return e.jsx("textarea",{id:t,...s,className:r,placeholder:a,required:i,defaultValue:m})}function Ie({id:t,registerOptions:s,className:r,placeholder:a,options:i,transform:m}){return e.jsxs("select",{id:t,...s,className:r,children:[e.jsx("option",{value:"",disabled:!0,hidden:!0,children:a}),i.map(x=>e.jsx("option",{value:m.input(x.value),className:"dark:bg-black dark:text-gray-300",children:x.label},x.value))]})}function b({label:t,id:s,type:r="text",register:a,errors:i,className:m="",options:x=[],transform:w={input:h=>h,output:h=>h},required:k=!1,placeholder:l=" ",defaultValue:o="",disabled:p=!1}){var j;const h={...a(s,{setValueAs:w.output})},c=`w-full
    block px-2.5 pb-2.5 pt-4 text-sm text-gray-900 bg-transparent border rounded-lg border-1  border-gray-300 dark:border-gray-600 shadow-sm appearance-none dark:text-white  dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer
    ${m}
  `,v=()=>{switch(r){case"textarea":return e.jsx(Ae,{id:s,registerOptions:h,className:c,placeholder:l,required:k,defaultValue:o,disabled:p});case"select":return e.jsx(Ie,{id:s,registerOptions:h,className:c,placeholder:l,options:x,transform:w,disabled:p});default:return e.jsx(Fe,{id:s,type:r,registerOptions:h,className:c,placeholder:l,required:k,defaultValue:o,disabled:p})}};return e.jsx(B.div,{initial:{y:10,opacity:0},animate:{y:0,opacity:1},transition:{duration:.2},children:e.jsxs("div",{className:"relative",children:[v(),e.jsx("label",{htmlFor:s,className:"absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-black px-2 peer-focus:px-2 peer-focus:text-blue-600 peer-focus:dark:text-blue-200 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto start-1",children:t}),i&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:(j=i[t])==null?void 0:j.message})]})})}function Te({passageType:t,register:s,errors:r,setValue:a,audioPreviewUrl:i,setAudioPreviewUrl:m,uploadProgress:x,trigger:w}){const[k,l]=N.useState(null),o=N.useCallback(c=>{c&&c.type.startsWith("audio/")&&(console.log("File being set:",c),a("data.passage.soundFile",c,{shouldValidate:!0}),m(URL.createObjectURL(c)),l(c.name))},[a,m]),p=c=>{const v=c.target.files[0];v&&(console.log("File selected:",v),console.log("File type:",v.type),console.log("File size:",v.size),o(v))},h=()=>{a("data.passage.soundFile",null,{shouldValidate:!0}),m(null),l(null);const c=document.getElementById("soundFile");c&&(c.value=""),w("data.passage.soundFile")};return N.useEffect(()=>()=>{i&&URL.revokeObjectURL(i)},[i]),e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{label:"Title",id:"data.passage.title",register:s,errors:r}),(r==null?void 0:r.title)&&e.jsx("p",{className:"text-red-500",children:r.title.message}),e.jsx(b,{label:"Text",id:"data.passage.text",type:"textarea",register:s,errors:r}),(r==null?void 0:r.text)&&e.jsx("p",{className:"text-red-500",children:r.text.message}),t==="listening"&&e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("input",{id:"soundFile",type:"file",accept:"audio/*",onChange:p,className:`block  text-sm text-gray-500\r
              file:mr-4 file:py-2 file:px-4\r
              file:rounded-md file:border-0\r
              file:text-sm file:font-semibold\r
              file:bg-blue-50 file:text-blue-700\r
              hover:file:bg-blue-100\r
              dark:file:bg-gray-700 dark:file:text-gray-300\r
              dark:hover:file:bg-gray-600`}),(r==null?void 0:r.soundFile)&&e.jsx("p",{className:"text-red-500",children:r.soundFile.message}),i&&e.jsxs("div",{className:"flex-shrink-0 flex gap-3 items-center justify-center",children:[e.jsx("audio",{controls:!0,src:i,className:"w-64 h-10",children:"Your browser does not support the audio element."}),e.jsxs("button",{type:"button",onClick:h,className:"flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-red-500",children:[e.jsx(K,{className:"mr-2"}),"Delete Audio"]})]})]}),x>0&&e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${x}%`}})}),e.jsx(b,{label:"URL (optional)",id:"data.passage.url",type:"url",register:s,errors:r,required:!1}),(r==null?void 0:r.url)&&e.jsx("p",{className:"text-red-500",children:r.url.message})]})}function Qe({type:t,register:s,errors:r,prefix:a}){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Answers"}),e.jsx("div",{className:"flex flex-col gap-2",children:[0,1,2,3].map(i=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{id:`${a}.answers.${i}`,register:s,errors:r,className:"flex-grow"}),t==="multiple_choice"&&e.jsx("input",{type:"checkbox",id:`${a}.correctAnswers.${i}`,...s(`${a}.correctAnswers.${i}`),className:"w-5 h-5 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"})]},i))}),t==="multiple_choice"&&r[`${a}.correctAnswers`]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r[`${a}.correctAnswers`].message})]}),t==="single_choice"&&e.jsx(b,{label:"Correct Answer",id:`${a}.correctAnswer`,register:s,errors:r})]})}function Ee({register:t,errors:s,prefix:r}){return e.jsxs(e.Fragment,{children:[e.jsx(b,{label:"Statement",id:`${r}.statement`,register:t,errors:s,type:"textarea",required:!0}),(s==null?void 0:s.statement)&&e.jsx("p",{className:"text-red-500",children:s.statement.message}),e.jsx(b,{label:"Correct Answer",id:`${r}.correctAnswer`,register:t,errors:s,type:"select",options:[{value:!0,label:"True"},{value:!1,label:"False"}],transform:{input:a=>String(a),output:a=>a==="true"}})]})}const L="The Great Barrier Reef, located off the coast of _____, is the world's largest coral reef system. It is so vast that it can be seen from _____. The reef is _____ to an incredible diversity of marine life;";function Pe({register:t,errors:s,prefix:r,control:a,setValue:i,watch:m,trigger:x}){const{fields:w,append:k,remove:l}=ce({control:a,name:`${r}.blanks`}),[o,p]=ae.useState({});N.useEffect(()=>{if(w.length===0){i(`${r}.text`,L);const f=(L.match(/_____/g)||[]).length;for(let d=0;d<f;d++)k({index:d+1,correctAnswer:"",options:[]})}},[]);const h=m(`${r}.text`),c=((h==null?void 0:h.match(/_____/g))||[]).length;console.log("error",s),N.useEffect(()=>{const f=w.length;if(c>f)for(let d=f;d<c;d++)k({index:d+1,correctAnswer:"",options:[]});else if(c<f)for(let d=f-1;d>=c;d--)l(d)},[c]);const v=(f,d)=>{if(!(d!=null&&d.trim()))return;const _=m(`${r}.blanks.${f}.options`)||[];_.includes(d.trim())||(i(`${r}.blanks.${f}.options`,[..._,d.trim()]),p(F=>({...F,[f]:""})))},j=(f,d)=>{const _=m(`${r}.blanks.${f}.options`)||[];i(`${r}.blanks.${f}.options`,_.filter((F,$)=>$!==d))};return N.useState(null),console.log("errors",s),e.jsxs(e.Fragment,{children:[e.jsx(b,{label:"Text (Use _____ (5 underscores) for blanks)",id:`${r}.text`,type:"textarea",register:t,errors:s,defaultValue:L}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Blanks"}),w.map((f,d)=>{var _,F;return e.jsxs("div",{className:"flex flex-col gap-2 mb-4 p-4 border rounded bg-white dark:bg-gray-800 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"w-8 text-center font-medium text-gray-600 dark:text-gray-300",children:["#",d+1]}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{...t(`${r}.blanks.${d}.correctAnswer`),className:`w-full p-2 border rounded-md bg-gray-50 dark:bg-gray-700 \r
                           border-gray-300 dark:border-gray-600 \r
                           text-gray-900 dark:text-gray-100\r
                           focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-600 \r
                           focus:border-blue-500 dark:focus:border-blue-600\r
                           placeholder-gray-400 dark:placeholder-gray-500`,placeholder:"Enter correct answer"})})]}),e.jsxs("div",{className:"ml-8",children:[e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"text",className:`flex-1 p-2 rounded-md\r
                           bg-gray-50 dark:bg-gray-700 \r
                           border border-gray-300 dark:border-gray-600\r
                           text-gray-900 dark:text-gray-100\r
                           focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-600\r
                           focus:border-blue-500 dark:focus:border-blue-600\r
                           placeholder-gray-400 dark:placeholder-gray-500`,placeholder:"Add an option (optional)",value:o[d]||"",onChange:$=>p(I=>({...I,[d]:$.target.value})),onKeyDown:$=>{$.key==="Enter"&&v(d,o[d])}}),e.jsx("button",{type:"button",onClick:()=>v(d,o[d]),className:`px-3 py-2 rounded-md\r
                           bg-green-50 dark:bg-green-900\r
                           text-green-600 dark:text-green-400\r
                           hover:bg-green-100 dark:hover:bg-green-800\r
                           transition-colors duration-200`,children:e.jsx(U,{})})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(_=m(`${r}.blanks.${d}.options`,[]))==null?void 0:_.map(($,I)=>e.jsxs("div",{className:`px-3 py-1 rounded-full\r
                               bg-gray-100 dark:bg-gray-700\r
                               text-gray-700 dark:text-gray-300\r
                               border border-gray-200 dark:border-gray-600\r
                               flex items-center gap-2`,children:[e.jsx("span",{children:$}),e.jsx("button",{type:"button",onClick:()=>j(d,I),className:`text-red-500 dark:text-red-400\r
                                 hover:text-red-700 dark:hover:text-red-300\r
                                 transition-colors duration-200`,children:"Ã—"})]},I))})]}),((F=s==null?void 0:s.blanks)==null?void 0:F[d])&&e.jsx("p",{className:"text-red-500 dark:text-red-400 text-sm ml-8",children:s.blanks[d].message})]},f.id)})]}),(s==null?void 0:s.blanks)&&e.jsx("p",{className:"text-red-500",children:s.blanks.message})]})}const O={type:"matching",section:"vocabulary",questionText:"Match the words with their definitions.",instruction:"Drag the items from the right column to match the items in the left column.",difficulty:3,leftColumn:[{id:1,text:"Exuberant"},{id:2,text:"Melancholy"},{id:3,text:"Stoic"}],rightColumn:[{id:"A",text:"Joyfully unrestrained"},{id:"B",text:"Sad or depressed"},{id:"C",text:"Showing little emotion"}],correctPairs:[{left:1,right:"A"},{left:2,right:"B"},{left:3,right:"C"}]};function Ve({register:t,errors:s,getValues:r,prefix:a}){const[i,m]=N.useState(3);N.useEffect(()=>{m(r(`${a}.leftColumn`).length)},[]);const x=()=>{i<8&&m(i+1)},w=k=>{if(i>3){m(i-1);for(let l=k;l<i-1;l++){["leftColumn","rightColumn"].forEach(f=>{const d=`${a}.${f}.${l+1}.id`,_=`${a}.${f}.${l+1}.text`,F=`${a}.${f}.${l}.id`,$=`${a}.${f}.${l}.text`,I=t(d).value,g=t(_).value;t(F).onChange({target:{value:I}}),t($).onChange({target:{value:g}})});const o=`${a}.correctPairs.${l+1}.left`,p=`${a}.correctPairs.${l+1}.right`,h=`${a}.correctPairs.${l}.left`,c=`${a}.correctPairs.${l}.right`,v=t(o).value,j=t(p).value;t(h).onChange({target:{value:v}}),t(c).onChange({target:{value:j}})}["leftColumn","rightColumn"].forEach(l=>{t(`${a}.${l}.${i-1}.id`).onChange({target:{value:""}}),t(`${a}.${l}.${i-1}.text`).onChange({target:{value:""}})}),t(`${a}.correctPairs.${i-1}.left`).onChange({target:{value:""}}),t(`${a}.correctPairs.${i-1}.right`).onChange({target:{value:""}})}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Matching Items"}),e.jsxs("div",{children:[e.jsx("button",{type:"button",onClick:()=>w(i-1),className:"mr-2 px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition-colors",disabled:i<=3,children:e.jsx(ne,{})}),e.jsx("button",{type:"button",onClick:x,className:"px-2 py-1 bg-green-500 text-white rounded hover:bg-green-600 transition-colors",disabled:i>=8,children:e.jsx(U,{})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Left Column"}),[...Array(i)].map((k,l)=>{var o,p;return e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(b,{id:`${a}.leftColumn.${l}.id`,register:t,errors:s,className:"w-[50px] flex-shrink-0",placeholder:`${(o=O.leftColumn[l])==null?void 0:o.id}`,type:"number",transform:{input:h=>h,output:h=>Number(h)}}),e.jsx("div",{className:"flex-grow",children:e.jsx(b,{id:`${a}.leftColumn.${l}.text`,register:t,errors:s,className:"w-full",placeholder:(p=O.leftColumn[l])==null?void 0:p.text})})]},l)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Right Column"}),[...Array(i)].map((k,l)=>{var o,p;return e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(b,{id:`${a}.rightColumn.${l}.id`,register:t,errors:s,className:"w-[50px] flex-shrink-0",placeholder:(o=O.rightColumn[l])==null?void 0:o.id,required:!0}),e.jsx("div",{className:"flex-grow",children:e.jsx(b,{id:`${a}.rightColumn.${l}.text`,register:t,errors:s,className:"w-full",placeholder:(p=O.rightColumn[l])==null?void 0:p.text,required:!0})})]},l)})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Correct Pairs"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[...Array(i)].map((k,l)=>{var o,p;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{id:`${a}.correctPairs.${l}.left`,register:t,errors:s,className:"w-12 flex-shrink-0",placeholder:(o=O.correctPairs[l])==null?void 0:o.left.toString(),required:!0,type:"number",transform:{input:h=>h,output:h=>Number(h)}}),e.jsx(b,{id:`${a}.correctPairs.${l}.right`,register:t,errors:s,className:"w-12 flex-shrink-0",placeholder:(p=O.correctPairs[l])==null?void 0:p.right})]},l)})})]})]})}const qe={type:"ordering",questionText:"Arrange the following sentences to form a coherent paragraph.",instruction:"Drag and drop the sentences into the correct order.",difficulty:4,items:[{id:"1",text:"However, with proper planning and execution, these challenges can be overcome."},{id:"2",text:"Urban gardening is becoming increasingly popular in cities around the world."},{id:"3",text:"It offers numerous benefits, including fresh produce and improved air quality."},{id:"4",text:"Space constraints and pollution are common obstacles faced by urban gardeners."}],correctOrder:["2","3","4","1"]};function Oe({register:t,getValues:s,errors:r,prefix:a,setValue:i}){var l;const[m,x]=N.useState([{id:"1",text:""},{id:"2",text:""},{id:"3",text:""}]);N.useEffect(()=>{const o=s(`${a}.items`);o.length>0&&x(o)},[]);const w=()=>{if(m.length<8){const o=(m.length+1).toString();console.log("newId",o),x([...m,{id:o,text:""}])}};N.useEffect(()=>{i(`${a}.items`,m)},[m]);const k=o=>{if(m.length>3){const p=m.filter((h,c)=>c!==o);x(p.map((h,c)=>({...h,id:(c+1).toString()})))}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Items"}),m.map((o,p)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-[60px] flex-shrink-0",children:e.jsx(b,{id:`${a}.items.${p}.id`,register:t,errors:r,className:"w-full text-center",placeholder:o.id,required:!0,disabled:!0,value:o.id})}),e.jsx("div",{className:"flex-grow",children:e.jsx(b,{id:`${a}.items.${p}.text`,register:t,errors:r,className:"w-full",placeholder:`item ${p+1}`,required:!0})}),e.jsx("button",{type:"button",onClick:()=>k(p),className:"p-2 text-red-500 hover:text-red-700 transition-colors",disabled:m.length<=3,children:e.jsx(K,{})})]},o.id)),((l=r.question)==null?void 0:l.items)&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.question.items.message})]}),e.jsxs("button",{type:"button",onClick:w,className:"mt-2 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors flex items-center",disabled:m.length>=8,children:[e.jsx(U,{className:"mr-2"})," Add Item"]}),e.jsx("div",{className:"mt-4",children:e.jsx(b,{label:"Correct Order",id:`${a}.correctOrder`,register:t,errors:r,transform:{input:o=>Array.isArray(o)?o.join(","):o,output:o=>typeof o=="string"?o.split(","):[]},required:!0,placeholder:qe.correctOrder.join(",")})})]})}function Re({register:t,errors:s,prefix:r}){return e.jsxs(e.Fragment,{children:[e.jsx(b,{label:"Prompt",id:`${r}.prompt`,type:"textarea",register:t,errors:s,required:!0}),(s==null?void 0:s.sampleAnswer)&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.sampleAnswer.message})]})}function Se({register:t,errors:s,prefix:r}){return e.jsxs(e.Fragment,{children:[e.jsx(b,{label:"Min Words",id:`${r}.minWords`,type:"number",register:t,errors:s,transform:{input:a=>a,output:a=>Number(a)}}),e.jsx(b,{label:"Max Words",id:`${r}.maxWords`,type:"number",register:t,errors:s,transform:{input:a=>a,output:a=>Number(a)}}),e.jsx(b,{label:"Rubric",id:`${r}.rubric`,type:"textarea",register:t,errors:s})]})}function Be({type:t,register:s,errors:r,prefix:a,control:i,watch:m,setValue:x,trigger:w,getValues:k}){switch(t){case"multiple_choice":case"single_choice":return e.jsx(Qe,{type:t,register:s,errors:r,prefix:a});case"true_false":return e.jsx(Ee,{register:s,errors:r,prefix:a});case"fill_in_the_blank":return e.jsx(Pe,{register:s,errors:r,prefix:a,control:i,watch:m,setValue:x,trigger:w});case"matching":return e.jsx(Ve,{register:s,getValues:k,errors:r,prefix:a});case"ordering":return e.jsx(Oe,{register:s,errors:r,prefix:a,control:i,getValues:k,setValue:x});case"open_ended":return e.jsx(Re,{register:s,errors:r,prefix:a});case"essay":return e.jsx(Se,{register:s,errors:r,prefix:a});default:return null}}function H({questionType:t,section:s,register:r,errors:a,prefix:i,setQuestionType:m,questionTypes:x,control:w,watch:k,setValue:l,getValues:o,isEditMode:p,trigger:h}){return e.jsxs(B.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Question Type"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:x.map(c=>e.jsx("button",{type:"button",disabled:p,onClick:()=>m(c),className:`p-2 rounded-md ${t===c?"bg-blue-500 text-white dark:bg-blue-700 dark:text-gray-300":"bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[me.find(v=>v.name===c).icon,c.replace("_"," ")]})},c))})]}),e.jsx(b,{label:"Question Text",id:`${i}.questionText`,type:"textarea",register:r,errors:a}),(a==null?void 0:a.questionText)&&e.jsx("p",{className:"text-red-500",children:a.questionText.message}),e.jsx(b,{label:"Instruction",id:`${i}.instruction`,type:"textarea",register:r,errors:a}),(a==null?void 0:a.instruction)&&e.jsx("p",{className:"text-red-500",children:a.instruction.message}),e.jsx(b,{label:"Difficulty",id:`${i}.difficulty`,type:"number",register:r,errors:a,className:"w-full",transform:{input:c=>c,output:c=>Number(c)}}),(a==null?void 0:a.difficulty)&&e.jsx("p",{className:"text-red-500",children:a.difficulty.message}),e.jsx(Be,{type:t,register:r,errors:a,prefix:i,control:w,watch:k,setValue:l,getValues:o,trigger:h})]})}function We({mode:t="add",initialData:s=null}){var G,J;const[r,{isLoading:a}]=re(),[i,{isLoading:m}]=ie(),[x,w]=N.useState(null),[k,l]=N.useState(0),o=le(),{register:p,handleSubmit:h,watch:c,reset:v,setValue:j,control:f,trigger:d,clearErrors:_,getValues:F,formState:{errors:$,isValid:I}}=de({resolver:ue(_e),mode:"onChange",defaultValues:s?{section:s.section||"reading",type:s.type||"single_choice",data:s.section==="reading"||s.section==="listening"?{passage:{passageType:s.section,title:s.title||"",text:s.text||"",url:s.url||"",...s.section==="listening"?{audioUrl:s.audioUrl||""}:{}},questions:[{type:s.type,...s}]}:{question:{type:s.type,...s}}}:{section:"reading",type:"single_choice",data:{passage:{passageType:"reading",title:"",text:"",url:""},questions:[{type:"single_choice",questionText:"",instruction:"",difficulty:1,answers:["","","",""],correctAnswer:"",section:"reading"}]}}}),g=c("section"),P=c("data.questions")||[],V=c("data.question");N.useEffect(()=>{},[$,I]),N.useEffect(()=>{if(t==="edit")return;const u={section:g,type:Q[g][0],data:g==="reading"||g==="listening"?{passage:{passageType:g,title:"",text:"",url:"",...g==="listening"?{audioUrl:""}:{}},questions:[{type:Q[g][0],questionText:"",instruction:"",difficulty:1,answers:["","","",""],correctAnswer:""}]}:{question:{type:Q[g][0],questionText:"",instruction:"",difficulty:1,answers:["","","",""],correctAnswer:""}}};v(u)},[g,v,t]);const W=()=>{v({section:"reading",data:{passage:{passageType:"reading",title:"",text:"",url:""},questions:[{type:"single_choice",questionText:"",instruction:"",difficulty:1,answers:["","","",""],correctAnswer:"",section:"reading"}]}}),w(null),l(0),_(),j("section","reading"),console.log("Form reset. New values:",F())},D=async u=>{var R,M;const y=new FormData;y.append("section",g);const A=C=>{if(C.type==="multiple_choice"){const q=Object.entries(C.correctAnswers).filter(([Z,T])=>T).map(([Z,T])=>C.answers[parseInt(Z)]);return console.log("correctAnswers",q),{...C,correctAnswers:q}}return C};try{if(t==="edit"&&(s!=null&&s._id)){const C={...u.data.question};(await i({id:s._id,data:C}).unwrap()).data&&(o("/my-questions"),S.success("Question updated successfully!"))}else if(g==="reading"||g==="listening"){g==="listening"&&y.append("soundFile",(M=(R=u.data)==null?void 0:R.passage)==null?void 0:M.soundFile);const C=u.data.questions.map(A);y.append("questions",JSON.stringify(C));const{soundFile:q,...Z}=u.data.passage;y.append("passage",JSON.stringify(Z)),l(0);const T=await r(y).unwrap();if(console.log("Result from addQuestion:",T),T.error)throw new Error(T.error.message||"Unknown error occurred");T.data?(console.log("Question added successfully. Result:",T.data),S.success("Question added successfully!")):(console.warn("Unexpected response format:",T),S.warn("Question may have been added, but the response was unexpected."))}else{const C=A(u.data.question);y.append("question",JSON.stringify(C));const q=await r(y).unwrap();console.log("Question added successfully. Result:",q),W(),o("/question"),S.success("Question added successfully!")}}catch(C){console.error("Error in onSubmit:",C),S.error(C.message||`Failed to ${t} question`),l(0)}},ee=()=>{const u={section:g,type:Q[g][0],questionText:"",instruction:"",difficulty:1,answers:["","","",""],correctAnswer:""};j("data.questions",[...P,u])},te=u=>{j("data.questions",P.filter((y,A)=>A!==u))},z=(u,y)=>{j(g==="reading"||g==="listening"?`data.questions.${u}.type`:"data.question.type",y)};N.useEffect(()=>{se(g)},[g]);const se=u=>{if(j("section",u),t==="edit")if(u==="reading"||u==="listening"){const y=P.map(A=>({...A,section:u}));j("data.questions",y)}else j("data.question",{...V,section:u});else if(u==="reading"||u==="listening"){const y=P.length>0?P.map(A=>({...A,section:u,type:Q[u][0]})):[{...V,section:u,type:Q[u][0]}];j("data.questions",y)}else j("data.question",{...V,section:u,type:Q[u][0]})};return N.useEffect(()=>{console.log("errors",$)},[$]),e.jsx(e.Fragment,{children:e.jsxs("form",{onSubmit:h(D),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Section"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ge.map(u=>e.jsx("button",{type:"button",disabled:t==="edit",className:`p-2 rounded-md ${g===u.name?"bg-blue-500 text-white dark:bg-blue-700 dark:text-gray-300":t==="edit"?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-300"}`,onClick:()=>{t!=="edit"&&j("section",u.name)},children:e.jsxs("div",{className:"flex items-center gap-2",children:[u.icon,u.label]})},u.name))})]}),(g==="reading"||g==="listening")&&e.jsxs(B.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Passage"}),e.jsx(Te,{passageType:g,register:p,errors:((G=$.data)==null?void 0:G.passage)||{},setValue:j,audioPreviewUrl:x,setAudioPreviewUrl:w,uploadProgress:k,trigger:d})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:g==="reading"||g==="listening"?"Questions":"Question"}),g==="reading"||g==="listening"?P.map((u,y)=>{var A,R;return e.jsxs(B.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"mb-4 p-4 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm dark:shadow-m",children:[e.jsxs("h3",{className:"text-lg font-medium mb-2",children:["Question ",y+1]}),e.jsx(H,{questionType:u.type,section:g,register:p,errors:((R=(A=$.data)==null?void 0:A.questions)==null?void 0:R[y])||{},prefix:`data.questions.${y}`,setQuestionType:M=>z(y,M),questionTypes:Q[g],control:f,watch:c,setValue:j,getValues:F,trigger:d,isEditMode:t==="edit"}),P.length>1&&t!=="edit"&&e.jsx("button",{type:"button",onClick:()=>te(y),className:"mt-2 px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600",children:"Remove Question"})]},y)}):e.jsx(B.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"",children:e.jsx(H,{questionType:V==null?void 0:V.type,section:g,register:p,errors:((J=$.data)==null?void 0:J.question)||{},prefix:"data.question",setQuestionType:u=>z(0,u),questionTypes:Q[g],control:f,watch:c,setValue:j,getValues:F,trigger:d,isEditMode:t==="edit"})}),(g==="reading"||g==="listening")&&t!=="edit"&&e.jsxs("button",{type:"button",onClick:ee,className:"flex items-center px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600",children:[e.jsx(oe,{className:"w-5 h-5 mr-2"}),"Add Question"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:`px-4 py-2 rounded ${I?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-500"}`,disabled:a||!I||m,children:t==="edit"?"Update":"Submit"}),t!=="edit"&&e.jsx("button",{type:"button",onClick:W,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",disabled:a,children:"Reset"})]})]})})}export{We as B};
