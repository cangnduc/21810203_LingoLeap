import{c as f,r as o,Q as w,j as e,S as k,M as N,T as C,U as S,V as A,u as L,L as M,k as R}from"./index-DVmOQZrp.js";import{S as T}from"./star-CBCcDk9R.js";import{S as E}from"./ScrollToTopBtn-C9QlDYc7.js";import{B as F}from"./button-D__oTSWQ.js";import{f as P}from"./format-C9os4azF.js";/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=f("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=f("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]),I=({testId:a})=>{const[s,i]=o.useState(0),[c,n]=o.useState(0),[l,{isLoading:t}]=w(),x=async d=>{try{await l({testId:a,rating:d}).unwrap(),i(d)}catch(r){console.error("Failed to add rating:",r)}};return e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Rating"}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(d=>e.jsx("button",{type:"button",onClick:()=>x(d),onMouseEnter:()=>n(d),onMouseLeave:()=>n(0),className:"focus:outline-none",disabled:t,children:e.jsx(T,{className:`w-8 h-8 ${d<=(c||s)?"fill-yellow-400 text-yellow-400":"text-gray-300 dark:text-gray-600"} transition-colors duration-150`})},d))})]})},B=({testId:a})=>{const[s,i]=o.useState(""),[c,{isLoading:n}]=k(),l=async t=>{if(t.preventDefault(),!!s.trim())try{await c({testId:a,comment:s.trim()}).unwrap(),i("")}catch(x){console.error("Failed to add comment:",x)}};return e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"comment",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Add a Comment"}),e.jsx("textarea",{id:"comment",rows:4,value:s,onChange:t=>i(t.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 \r
                   focus:border-blue-500 bg-white dark:bg-gray-700 \r
                   text-gray-900 dark:text-gray-100 border-gray-300 \r
                   dark:border-gray-600 placeholder-gray-400 \r
                   dark:placeholder-gray-500`,placeholder:"Share your thoughts..."})]}),e.jsx("button",{type:"submit",className:`w-full px-4 py-2 text-white bg-blue-600 rounded-lg \r
                 hover:bg-blue-700 focus:outline-none focus:ring-2 \r
                 focus:ring-blue-500 focus:ring-offset-2 \r
                 dark:focus:ring-offset-gray-800 transition-colors\r
                 disabled:opacity-50 disabled:cursor-not-allowed`,disabled:n||!s.trim(),children:"Add Comment"})]})},Q=({children:a,className:s=""})=>e.jsx("div",{className:`relative inline-block h-10 w-10 rounded-full bg-gray-200 ${s}`,children:a}),V=({children:a,className:s=""})=>e.jsx("div",{className:`flex h-full w-full items-center justify-center rounded-full bg-gray-200 text-gray-600 ${s}`,children:a}),_=({comment:a})=>{var c,n,l,t;const s=new Date(a.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),i=(c=a.user)!=null&&c.username?a.user.username.charAt(0).toUpperCase():"?";return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-3",children:[(n=a.user)!=null&&n.avatar?e.jsx("img",{src:a.user.avatar,alt:((l=a.user)==null?void 0:l.username)||"User",className:"w-8 h-8 rounded-full object-cover"}):e.jsx(Q,{children:e.jsx(V,{children:i})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("h4",{className:"text-sm font-medium text-gray-800 dark:text-gray-100",children:((t=a.user)==null?void 0:t.username)||"Anonymous"})}),e.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400",children:[e.jsx($,{className:"h-3 w-3 mr-1"}),s]})]})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-sm",children:a.text})]})},D=()=>{var b,p,j;const{id:a}=N(),[s,i]=o.useState(!1),[c,n]=o.useState(1),l=o.useRef(null),{data:t,isLoading:x,error:d,isFetching:r}=C({testId:a,page:c,limit:5},{skip:!s}),h=o.useMemo(()=>{var m;return((m=t==null?void 0:t.data)==null?void 0:m.comments)||[]},[(b=t==null?void 0:t.data)==null?void 0:b.comments]),g=((p=t==null?void 0:t.pagination)==null?void 0:p.hasMore)||!1;o.useEffect(()=>{if(!g||r)return;const m=new IntersectionObserver(y=>{y[0].isIntersecting&&g&&!r&&n(v=>v+1)},{threshold:1});return l.current&&m.observe(l.current),()=>m.disconnect()},[g,r]),o.useEffect(()=>{n(1)},[s]);const u=()=>{i(!0)};return e.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-6",children:"Reviews"}),e.jsxs("div",{className:"space-y-6 mb-8",children:[e.jsx(I,{testId:a}),e.jsx(B,{testId:a})]}),s?e.jsx("div",{className:"space-y-4",children:x?e.jsx("div",{className:"text-center py-8",children:e.jsx(S,{})}):d?e.jsxs("div",{className:"text-center py-8 text-red-500",children:["Error: ",d.message]}):h.length===0?e.jsx("div",{className:"text-center py-8 bg-gray-50 dark:bg-gray-800 rounded-lg",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No comments yet"})}):e.jsxs(e.Fragment,{children:[h.map((m,y)=>e.jsx(_,{comment:m},`${m._id}-${y}`)),g&&e.jsx("div",{ref:l,className:"h-16 flex items-center justify-center text-sm text-gray-500",children:r?"Loading more comments...":"Load more comments"})]})}):e.jsxs(F,{onClick:u,className:"w-full flex items-center justify-center gap-2 py-3",children:[e.jsx(U,{className:"w-5 h-5"}),"View Comments",((j=t==null?void 0:t.pagination)==null?void 0:j.totalComments)>0&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-gray-200 dark:bg-gray-700 rounded-full text-sm",children:t.pagination.totalComments})]}),e.jsx(E,{})]})},G=()=>e.jsx(D,{}),J=()=>{const{id:a}=N(),{data:s,isLoading:i,isError:c,error:n}=A(a),{user:l}=L(r=>r.auth),t=r=>P(new Date(r),"MMM dd, yyyy"),x=r=>{var g;return((g=R.find(u=>u.value===r))==null?void 0:g.color)||"bg-blue-500"};console.log("test",s);const d=()=>s.passingScore/s.totalPossibleScore*100;return i?e.jsx("div",{children:"Loading..."}):s&&e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:s.title}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2",children:s.description})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-end gap-2",children:[s.createdBy===l._id&&e.jsx(M,{to:`/tests/${a}/edit`,className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-1 rounded-full text-sm transition-colors",children:"Edit Test"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`${x(s.difficulty)} text-white px-3 py-1 rounded-full text-sm`,children:s.difficulty}),e.jsx("span",{className:"bg-blue-500 text-white px-3 py-1 rounded-full text-sm",children:s.testType.toUpperCase()})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 text-center",children:[e.jsx("h6",{className:"text-gray-600 dark:text-gray-300",children:"Duration"}),e.jsxs("h3",{className:"text-xl font-bold mt-2 dark:text-white",children:[s.duration," mins"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 text-center",children:[e.jsx("h6",{className:"text-gray-600 dark:text-gray-300",children:"Total Score"}),e.jsx("h3",{className:"text-xl font-bold mt-2 dark:text-white",children:s.totalPossibleScore})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 text-center",children:[e.jsx("h6",{className:"text-gray-600 dark:text-gray-300",children:"Attempts Allowed"}),e.jsxs("h3",{className:"text-xl font-bold mt-2 dark:text-white",children:[s.totalAttempts,"/",s.attemptsAllowed]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 text-center",children:[e.jsx("h6",{className:"text-gray-600 dark:text-gray-300",children:"Total participants"}),e.jsx("h3",{className:"text-xl font-bold mt-2 dark:text-white",children:s.participantCount||0})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6",children:[e.jsxs("h5",{className:"font-bold mb-3 dark:text-white",children:["Passing Score: ",s.passingScore," / ",s.totalPossibleScore]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2.5",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${d()}%`}})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md mb-6",children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 p-4",children:e.jsx("h5",{className:"font-bold dark:text-white",children:"Test Sections"})}),e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:s.sections.map(r=>e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"font-semibold capitalize mb-1 dark:text-white",children:r.name}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-sm",children:r.instruction})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("span",{className:"bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-100 px-3 py-1 rounded-full text-sm whitespace-nowrap",children:[r.duration," mins"]}),e.jsxs("span",{className:"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-100 px-3 py-1 rounded-full text-sm whitespace-nowrap",children:[r.sectionScore," points"]})]})]})},r._id))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("h5",{className:"font-bold mb-4 dark:text-white",children:"Test Availability"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-1",children:"Available From:"}),e.jsx("strong",{className:"dark:text-white",children:t(s.availableFrom)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-1",children:"Available Until:"}),e.jsx("strong",{className:"dark:text-white",children:t(s.availableUntil)})]})]})]}),e.jsx(G,{})]})};export{J as default};
